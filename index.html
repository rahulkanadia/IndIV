<!DOCTYPE html>
<html>
<head>
  <title>IndIV â€” Volatility Monitor</title>
  <meta charset="utf-8" />
  <style>
    body { background: #0b0b0b; color: #eee; font-family: system-ui, -apple-system, BlinkMacSystemFont; padding: 20px; }
    h2, h3 { margin-bottom: 6px; }
    table { border-collapse: collapse; margin-top: 10px; width: 100%; font-size: 13px; }
    th, td { border: 1px solid #333; padding: 6px; text-align: right; }
    th { background: #111; }
    .row { margin-bottom: 12px; }
    select { background: #222; color: #fff; border: 1px solid #444; padding: 5px; margin-bottom: 15px; }
  </style>
</head>
<body>

<h2>IndIV Monitor</h2>

<select id="assetSelect">
  <option value="NIFTY">NIFTY</option>
  <option value="BANKNIFTY">BANKNIFTY</option>
  <option value="CRUDEOIL">CRUDEOIL</option>
  <option value="GOLD">GOLD</option>
</select>
<button onclick="loadData()">Refresh</button>

<div id="app">Loading...</div>

<script>
let allData = {}

async function loadData() {
  try {
    // 1. Fetch the JSON file generated by GitHub Actions
    // Note: Add a timestamp to prevent browser caching
    const r = await fetch(`./indiv_data.json?t=${Date.now()}`)
    if (!r.ok) throw new Error("Data file not found (Action may not have run yet)")
    
    allData = await r.json()
    render()
  } catch (e) {
    document.getElementById("app").innerText = e.message
  }
}

function render() {
  const asset = document.getElementById("assetSelect").value
  const data = allData[asset]

  if (!data) {
    document.getElementById("app").innerText = `No data available for ${asset}`
    return
  }

  const w = data.weekly
  if (!w) {
    document.getElementById("app").innerText = `${asset}: Futures Only (No Options Data)`
    return
  }
  
  const atm = w.rows.find(r => r.strike === w.atmStrike) || w.rows[0]

  document.getElementById("app").innerHTML = `
    <div class="row">
      <b>Updated:</b> ${new Date(data.timestamp).toLocaleTimeString()} <br>
      <b>Futures:</b> ${data.futures} | 
      <b>Weekly IV:</b> ${(data.headline.weekly * 100).toFixed(2)}%
    </div>
    <div class="row">
        <b>ATM Strike:</b> ${w.atmStrike} | 
        <b>Straddle:</b> ${(atm.call.price + atm.put.price).toFixed(2)}
    </div>
    
    <h3>Option Chain (Weekly)</h3>
    <table>
      <tr><th>Call IV</th><th>Price</th><th>Strike</th><th>Price</th><th>Put IV</th></tr>
      ${w.rows.map(r => `
        <tr>
          <td>${(r.call.iv*100).toFixed(1)}%</td>
          <td>${r.call.price}</td>
          <td><b>${r.strike}</b></td>
          <td>${r.put.price}</td>
          <td>${(r.put.iv*100).toFixed(1)}%</td>
        </tr>
      `).join("")}
    </table>
  `
}

document.getElementById("assetSelect").addEventListener("change", render)
loadData() // Initial Load
</script>

</body>
</html>
