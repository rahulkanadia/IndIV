<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndIV Monitor V25 (Modular)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <link rel="stylesheet" href="frontend/global.css">
    
    <link rel="stylesheet" href="frontend/components/charts/chart-dashboard/chart-dashboard.css">
    <link rel="stylesheet" href="frontend/components/market-grid/market-grid.css">
    <link rel="stylesheet" href="frontend/components/charts/intraday-iv-rv/chart-intraday.css">
    <link rel="stylesheet" href="frontend/components/tables/sd-table/sd-table.css">
    <link rel="stylesheet" href="frontend/components/tables/greeks-table/greeks-table.css">
    <link rel="stylesheet" href="frontend/components/pcr-widget/pcr-widget.css">

    <style>
        #ticker-tape {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-right: 20px;
            font-family: 'Segoe UI', sans-serif;
            font-size: 13px;
        }
        .ticker-item { color: #ccc; font-weight: 500; }
        .ticker-val { color: #fff; font-weight: 700; margin-left: 5px; }
        .ticker-up { color: #00E676; font-size: 11px; margin-left: 3px; }
        .ticker-down { color: #FF5252; font-size: 11px; margin-left: 3px; }
    </style>
</head>
<body>

    <div class="header-row">
        <div class="header-left">
            <h1>IndIV <span class="sub-title">Volatility monitor for Indian markets</span></h1>
        </div>
        
        <div class="header-right">
            <div id="ticker-tape"></div> <a href="#" class="help-btn">How to use?</a>
            <div class="status-badge">‚óè LIVE DATA</div>
        </div>
    </div>

    <div class="container">

        <div class="left-panel">
            <div id="weekly-grid-container"></div>
            <div id="main-chart-dashboard"></div>
            <div id="monthly-grid-container"></div>
        </div>

        <div class="right-panel">
            <div class="split-header">
                <div class="split-half">
                    <span class="panel-title">
                        Intraday IV & RV
                        <div class="legend-row">
                            <div class="leg-item"><div class="line-box" style="border-top:1px solid #FF9800; width: 10px;"></div>Wk IV</div>
                            <div class="leg-item"><div class="line-box" style="border-top:3px solid #FF9800; width: 10px;"></div>Mo IV</div>
                        </div>
                    </span>
                    <div id="chart-trend" style="width:100%; height:100%"></div>
                </div>
                <div class="split-half">
                    <div id="sd-table-container"></div>
                    <div id="pcr-container"></div>
                </div>
            </div>

            <div id="greeks-table-container"></div>
        </div>
    </div>

<script type="module">
    import { mockData } from './frontend/mockdata.js';
    import { renderMarketGrid } from './frontend/components/market-grid/market-grid.js';
    import { renderChartDashboard } from './frontend/components/charts/chart-dashboard/chart-dashboard.js';
    import { renderIntradayChart } from './frontend/components/charts/intraday-iv-rv/chart-intraday.js';
    import { renderSDTable } from './frontend/components/tables/sd-table/sd-table.js';
    import { renderGreeksTable } from './frontend/components/tables/greeks-table/greeks-table.js';
    import { renderPCRSpark } from './frontend/components/pcr-widget/pcr-widget.js';

    // NEW: Simple Ticker Renderer
    function renderTickerTape(containerId, data) {
        const container = document.getElementById(containerId);
        if(!container) return;
        
        // Helper for color class
        const getCls = (txt) => txt.includes('+') ? 'ticker-up' : 'ticker-down';
        
        // Hardcoded simulation based on mockData spot/futures, 
        // normally you'd calculate change % from data
        const spotChg = "+45.20 (0.17%)";
        const futChg = "+37.00 (0.14%)";

        container.innerHTML = `
            <div class="ticker-item">NIFTY 50 <span class="ticker-val">${data.spot.toLocaleString()}</span> <span class="${getCls(spotChg)}">${spotChg}</span></div>
            <div style="width:1px; height:14px; background:#333"></div>
            <div class="ticker-item">FUT <span class="ticker-val">26,187.00</span> <span class="${getCls(futChg)}">${futChg}</span></div>
        `;
    }

    function init() {
        console.log("Initializing Dashboard...");

        // 1. Render Header Ticker
        renderTickerTape('ticker-tape', mockData);

        // 2. Grids
        renderMarketGrid('weekly-grid-container', 'WEEKLY', mockData.gridWeekly, 't-week');
        renderMarketGrid('monthly-grid-container', 'MONTHLY', mockData.gridMonthly, 't-month');

        // 3. Main Dashboard Charts
        renderChartDashboard('main-chart-dashboard');

        // 4. Right Panel Components
        renderIntradayChart('chart-trend', mockData.intraday);
        renderSDTable('sd-table-container', mockData);
        renderGreeksTable('greeks-table-container', mockData);
        renderPCRSpark('pcr-container', mockData.pcr);
    }

    init();

</script>

</body>
</html>
